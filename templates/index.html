<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pyGallery - Inicio</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="barra-usuario">
        {% if session.usuario_nombre %}
            <span>Hola, {{ session.usuario_nombre }}</span>
            <a href="/logout" class="btn-nav btn-logout">Cerrar Sesion</a>
        {% else %}
            <a href="/login" class="btn-nav">Iniciar Sesion</a>
        {% endif %}
    </div>

    <h1>Tu espacio</h1>

    {% if session.usuario_nombre %}
        <div class="accion-principal">
            <a href="/subir" class="boton-grande">Subir archivo</a>
        </div>
        
        <div class="espacio-container">
            <div class="espacio-texto">
                Espacio utilizado: <strong>{{ espacio_usado }}</strong> de <strong>15.00 GB</strong>
            </div>
            <div class="espacio-barra-fondo">
                <div class="espacio-barra-progreso {% if porcentaje > 90 %}alerta{% endif %}" 
                     style="width: {{ porcentaje }}%;"></div>
            </div>
        </div>
    {% endif %}
    
    <div class="galeria">
    {% for foto in fotos %}
        <div class="card">
            {% set extension = foto.nombre_archivo.split('.')[-1].lower() %}
            <div class="media-container">
                {% if extension in ['mp4', 'webm'] %}
                    <video controls preload="metadata">
                        <source src="{{ url_for('static', filename='imagenes/' ~ session.usuario_id ~ '/' ~ foto.nombre_archivo) }}" type="video/{{ extension }}">
                    </video>
                {% elif extension in ['png', 'jpg', 'jpeg', 'gif', 'webp'] %}
                    <a href="{{ url_for('static', filename='imagenes/' ~ session.usuario_id ~ '/' ~ foto.nombre_archivo) }}" target="_blank">
                        <img src="{{ url_for('static', filename='imagenes/' ~ session.usuario_id ~ '/' ~ foto.nombre_archivo) }}" loading="lazy">
                    </a>
                {% else %}
                    <div style="text-align: center; padding: 20px;">
                        <p style="font-size: 0.8em; color: #94a3b8; margin-bottom: 10px;">Formato {{ extension.upper() }} no compatible con reproducción directa</p>
                        <a href="{{ url_for('static', filename='imagenes/' ~ session.usuario_id ~ '/' ~ foto.nombre_archivo) }}" 
                           download class="btn-nav" style="background: #2563eb;">Descargar para ver</a>
                    </div>
                {% endif %}
            </div>
            
            <div class="card-info">
                <div class="card-title">{{ foto.titulo }}</div>
            </div>

            <a href="/borrar/{{ foto.id }}" class="btn-borrar" onclick="return confirm('¿Seguro?');">Eliminar</a>
        </div>
    {% endfor %}
</div>

</body>
</html>